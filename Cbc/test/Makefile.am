# Copyright (C) 2006 International Business Machines and others.
# All Rights Reserved.
# This file is distributed under the Common Public License.

## $Id$

# Author:  Andreas Waechter           IBM    2006-04-13

AUTOMAKE_OPTIONS = foreign

########################################################################
#                         unitTest for Cbc                             #
########################################################################

CBC_TEST_TGTS = gamstests ositests

if COIN_HAS_CLP
  CBC_TEST_TGTS += test_cbc
endif
if CBC_BUILD_CBC_GENERIC
if COIN_HAS_SAMPLE
  CBC_TEST_TGTS += test_cbc_generic
endif
endif

cbcflags =
ositestsflags =
if COIN_HAS_SAMPLE
  cbcflags += -dirSample `$(CYGPATH_W) $(SAMPLE_DATA)`
  ositestsflags += -mpsDir=`$(CYGPATH_W) $(SAMPLE_DATA)`
endif
cbcflags += -unitTest
if COIN_HAS_MIPLIB3
  cbcflags += -dirMiplib `$(CYGPATH_W) $(MIPLIB3_DATA)` -miplib
endif
if COIN_HAS_NETLIB
  ositestsflags += -netlibDir=`$(CYGPATH_W) $(NETLIB_DATA)` -testOsiSolverInterface
endif

# We are using the solver executables to do the unit test

test: $(CBC_TEST_TGTS)

test_cbc: ../src/cbc$(EXEEXT)
	../src/cbc$(EXEEXT) $(cbcflags)

if COIN_HAS_SAMPLE
test_cbc_generic: ../src/cbc-generic$(EXEEXT)
	echo "A minimal test is all that cbc-generic can manage just yet."
	../src/cbc-generic$(EXEEXT) \
	    -directory `$(CYGPATH_W) $(SAMPLE_DATA)` -import p0033.mps -branch
endif

gamstests: gamsTest$(EXEEXT)
	./gamsTest$(EXEEXT)

.PHONY: test

bin_PROGRAMS = gamsTest osiUnitTest

gamsTest_SOURCES = gamsTest.cpp
gamsTest_LDADD = ../src/libCbcSolver.la ../src/libCbc.la $(COINDEPEND_LIBS) $(ADDLIBS)
gamsTest_LDFLAGS = -rpath $(libdir)

AM_CPPFLAGS = -I`$(CYGPATH_W) $(srcdir)/../src` $(COINDEPEND_CFLAGS)

if COIN_HAS_CLP
  AM_CPPFLAGS += $(CLP_CFLAGS)
  gamsTest_LDADD += $(CLP_LIBS)
endif

if COIN_HAS_CPX
  AM_CPPFLAGS += $(CPX_CFLAGS)
  gamsTest_LDADD += $(CPX_LIBS)
endif

if COIN_HAS_DYLP
  AM_CPPFLAGS += $(DYLP_CFLAGS)
  gamsTest_LDADD += $(DYLP_LIBS)
endif

if COIN_HAS_GLPK
  AM_CPPFLAGS += $(GLPK_CFLAGS)
  gamsTest_LDADD += $(GLPK_LIBS)
endif

if COIN_HAS_MSK
  AM_CPPFLAGS += $(MSK_CFLAGS)
  gamsTest_LDADD += $(MSK_LIBS)
endif

# if COIN_HAS_SPX
#   AM_CPPFLAGS += $(SPX_CFLAGS)
#   gamsTest_LDADD += $(SPX_LIBS)
# endif

if COIN_HAS_VOL
  AM_CPPFLAGS += $(VOL_CFLAGS)
  gamsTest_LDADD += $(VOL_LIBS)
endif

if COIN_HAS_XPR
  AM_CPPFLAGS += $(XPR_CFLAGS)
  gamsTest_LDADD += $(XPR_LIBS)
endif

if COIN_HAS_ASL
  AM_CPPFLAGS += $(ASL_CFLAGS)
  gamsTest_LDADD += $(ASL_LIBS)
endif

########################################################################
#                         unitTest for OsiCbc                          #
########################################################################

osiUnitTest_SOURCES = osiUnitTest.cpp OsiCbcSolverInterfaceTest.cpp

osiUnitTest_LDADD = ../src/libCbc.la ../src/OsiCbc/libOsiCbc.la $(COINDEPEND_LIBS) $(OSITESTS_LIBS) $(ADDLIBS)

AM_CPPFLAGS += $(OSITESTS_CFLAGS) \
        -I`$(CYGPATH_W) $(srcdir)/../src/OsiCbc`

ositests: osiUnitTest$(EXEEXT)
	./osiUnitTest$(EXEEXT) $(ositestsflags)

########################################################################
#                          Cleaning stuff                              #
########################################################################

# Here we list everything that is not generated by the compiler, e.g.,
# output files of a program

DISTCLEANFILES = yy.mps xx.mps
